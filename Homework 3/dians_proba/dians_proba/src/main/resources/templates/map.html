<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>OpenStreetMap with Leaflet</title>-->
<!--    &lt;!&ndash; Include Leaflet CSS &ndash;&gt;-->
<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />-->
<!--    &lt;!&ndash; Include Leaflet Control Geocoder CSS &ndash;&gt;-->
<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />-->
<!--    <style>-->
<!--        /* Set the map container to cover the entire screen */-->
<!--        body, html, #map {-->
<!--            height: 100%;-->
<!--            margin: 0;-->
<!--        }-->

<!--        /* Add some styles for the search control */-->
<!--        .leaflet-control-geocoder {-->
<!--            margin-top: 10px;-->
<!--            margin-right: 10px;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--&lt;!&ndash; Create a div to hold the map &ndash;&gt;-->
<!--<div id="map"></div>-->

<!--&lt;!&ndash; Include Leaflet JavaScript &ndash;&gt;-->
<!--<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>-->
<!--&lt;!&ndash; Include Leaflet Control Geocoder JavaScript &ndash;&gt;-->
<!--<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>-->

<!--<script>-->
<!--    // Initialize the map-->
<!--    var mymap = L.map('map').setView([41.6086, 21.7453], 8.5); // Centered over Macedonia-->

<!--    // Add the OpenStreetMap tile layer-->
<!--    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {-->
<!--        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'-->
<!--    }).addTo(mymap);-->

<!--    // Add a marker to the map-->
<!--    var marker = L.marker([41.6086, 21.7453]).addTo(mymap);-->

<!--    // Add a popup to the marker-->
<!--    marker.bindPopup("<b>Macedonia</b><br>Welcome to Macedonia!").openPopup();-->

<!--    // Add the geocoder control to the map-->
<!--    L.Control.geocoder().addTo(mymap);-->
<!--</script>-->

<!--</body>-->
<!--</html>-->
<div>MAP</div>
<!--<button onclick="getLocation()">Get Location</button>-->


<script>
    // Check if the function has already been called in the current session
    const hasLocationBeenFetched = sessionStorage.getItem('hasLocationBeenFetched');

    // If not, call the getLocation function
    if (!hasLocationBeenFetched) {
        window.onload = function() {
            getLocation();
        };
    }

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    }

    function showPosition(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;

        // Send the location to your Spring Controller
        window.location.href = `/getLocation?latitude=${latitude}&longitude=${longitude}`;

        // Set a flag in sessionStorage indicating that the location has been fetched
        sessionStorage.setItem('hasLocationBeenFetched', true);
    }
</script>